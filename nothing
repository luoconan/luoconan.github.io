// ==UserScript==
// @name         auto Upload tripSheet2
// @namespace    http://Conanluo.com/
// @version      1.0.3
// @description  uploading
// @author       Conanluo
// @match        https://awmt.transmedik.com/trips/trip-sheet
// @match        https://work.conanluo.com/nemt/tripSheet.html?k=4
// @icon         https://www.google.com/s2/favicons?sz=64&domain=nemtplatform.com
// @grant        GM_xmlhttpRequest
// @downloadURL https://update.greasyfork.org/scripts/538682/auto%20Upload%20tripSheet.user.js
// @updateURL https://update.greasyfork.org/scripts/538682/auto%20Upload%20tripSheet.meta.js
// ==/UserScript==

(async function() {

    const workerUrl = 'https://tripsheetdata.conanluo.workers.dev/save';

    let driversTrip=[
        {id: "Han Yang Zhou",passengers: []},
        {id: "Rong Tang",passengers: []},
        {id: "Mauricio Reina",passengers: []},
        {id: "Jerry Higgins",passengers: []},
        {id: "Mingzhan Li",passengers: []},
        {id: "Fook Fung",passengers: []},
        {id: "Walter Mejia",passengers: []},
        {id: "Zhao Zhong Zheng",passengers: []},
        {id: "Jabari Tyler",passengers: []},
        {id: "Yingyang Chen",passengers: []},
        {id: "Bert Reid",passengers: []},
        {id: "Jie Qian",passengers: []},
        {id: "Jerald Alejandro",passengers: []},
        {id: "Wilson Ochoa",passengers: []},
        {id: "unknow Driver",passengers: []}
    ]

    // å‡½æ•°ï¼šä¿å­˜å­—ç¬¦ä¸²å’Œæ—¶é—´æˆ³åˆ° Cloudflare KV
    function saveToKV(content) {
        const timestamp = new Date().toISOString();
        GM_xmlhttpRequest({
            method: 'POST',
            url: workerUrl,
            headers: {
                'Content-Type': 'application/json'
            },
            data: JSON.stringify({  timestamp, content }),
            onload: function(response) {
                if (response.status === 200) {
                    console.log('æ•°æ®å·²ä¿å­˜åˆ° KV:', response.responseText);
                } else {
                    console.error('é”™è¯¯:', response.status, response.responseText);
                }
            },
            onerror: function() {
                console.error('ç½‘ç»œé”™è¯¯');
            }
        });
    }




    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


        // ç¼“å­˜ä¸Šæ¬¡è·å–çš„è¡Œç¨‹æ•°æ®
    let cachedTrips = [];

    // è·å– JWT tokenï¼ˆæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰
    const getToken = () => {
        // å°è¯•ä» cookie è·å– token
        const token = document.cookie.split('; ').find(row => row.startsWith('jwt='));
        if (token) return token.split('=')[1];

        // æˆ–è€…ä» localStorage è·å–
        // return localStorage.getItem('jwt_token') || 'your_token_here';

        // åå¤‡ tokenï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰
        console.warn('ä½¿ç”¨åå¤‡ tokenï¼Œè¯·æ›´æ–° getToken é€»è¾‘ä»¥é€‚åº”å®é™…ç¯å¢ƒ');
        return 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiNjdlZDRlZTc5ZjBkOGMzNDJmYjFhNzU2IiwiYWNjb3VudFN0YXR1cyI6ImFjdGl2ZSIsInNJZCI6IjY3ZmQ5ZGY5OGE2NTM0MGI4NTZjYzc4ZCIsInRva2VuS2V5IjoiMTc0MzE5MzU3OTgyNyIsInJvbGVzIjoiY29tcGFueSIsImlhdCI6MTc1MTg2MDUyN30.NXtapunZ0iDQBAtT-rGsetXcGvX5at-fkP1J5Bd5o8A';
    };

    // è·å–å¤ªå¹³æ´‹æ—¶é—´ï¼ˆPDTï¼ŒUTC-7ï¼‰çš„å½“å¤©æ—¥æœŸå¹¶è½¬æ¢ä¸º UTC æ ¼å¼
    const getScheduleTimeRange = () => {
        const now = new Date();
        // è®¾ç½®ä¸ºå¤ªå¹³æ´‹æ—¶é—´
        const pdtDate = new Date(now.toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));

        // è·å–å½“å¤© 00:00:00 PDT
        const startDate = new Date(pdtDate.getFullYear(), pdtDate.getMonth(), pdtDate.getDate(), 0, 0, 0, 0);
        // è½¬æ¢ä¸º UTCï¼ˆPDT ä¸º UTC-7ï¼Œéœ€åŠ  7 å°æ—¶ï¼‰
        const startUTC = new Date(startDate.getTime() + 7 * 60 * 60 * 1000);

        // è·å–æ¬¡æ—¥ 00:00:00 PDTï¼ˆå³å½“å¤©çš„ 23:59:59.999ï¼‰
        const endDate = new Date(startDate.getTime() + 24 * 60 * 60 * 1000 - 1);
        const endUTC = new Date(endDate.getTime() + 7 * 60 * 60 * 1000);

        // æ ¼å¼åŒ–ä¸º API æ‰€éœ€çš„ UTC æ—¶é—´å­—ç¬¦ä¸²
        const startTime = startUTC.toISOString().replace('.000Z', '.000Z');
        const endTime = endUTC.toISOString().replace('.000Z', '.999Z');

        return `${startTime},${endTime}`;
    };

    // ä½¿ç”¨ GM_xmlhttpRequest è°ƒç”¨ API
    const fetchTrips = async (skip) => {
        const token = getToken();
        const scheduleTime = getScheduleTimeRange();
        return new Promise((resolve, reject) => {
            GM_xmlhttpRequest({
                method: 'GET',
                url: `https://apis.nemtplatform.com/api/assigns?status=all&skip=${skip}&scheduleTime=${scheduleTime}`,
                headers: {
                    'Accept': 'application/json, text/plain, */*',
                    'Accept-Language': 'en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7',
                    'Authorization': `JWT ${token}`,
                    'Connection': 'keep-alive',
                    'Content-Type': 'application/json',
                    // ç§»é™¤ If-None-Match ä»¥å¼ºåˆ¶è·å–æœ€æ–°æ•°æ®
                    // 'If-None-Match': 'W/"1447a-j5jo30GKahvv+9piyw9wxd+sKpI"',
                    'Origin': 'https://awmt.transmedik.com',
                    'Referer': 'https://awmt.transmedik.com/',
                    'Sec-Fetch-Dest': 'empty',
                    'Sec-Fetch-Mode': 'cors',
                    'Sec-Fetch-Site': 'cross-site',
                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36',
                    'sec-ch-ua': '"Not)A;Brand";v="8", "Chromium";v="138", "Google Chrome";v="138"',
                    'sec-ch-ua-mobile': '?0',
                    'sec-ch-ua-platform': '"Windows"'
                },
                anonymous: false,
                onload: function(response) {
                    if (response.status === 200) {
                        try {
                            const data = JSON.parse(response.responseText);
                            cachedTrips = data; // æ›´æ–°ç¼“å­˜
                            resolve(data);
                        } catch (e) {
                            reject(new Error('è§£æ JSON å¤±è´¥: ' + e.message));
                        }
                    } else if (response.status === 304) {
                        // å¤„ç† 304 çŠ¶æ€ç ï¼Œè¿”å›ç¼“å­˜æ•°æ®
                        console.log(`Skip=${skip} æ•°æ®æœªæ›´æ”¹ï¼Œä½¿ç”¨ç¼“å­˜æ•°æ®`);
                        resolve(cachedTrips);
                    } else {
                        reject(new Error(`è¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}`));
                    }
                },
                onerror: function(error) {
                    reject(new Error('ç½‘ç»œé”™è¯¯: ' + error.message));
                }
            });
        });
    };

    // å¾ªç¯è·å–æ‰€æœ‰æ•°æ®ï¼ˆskip=0 åˆ° 1500ï¼‰
    const fetchAllTrips = async () => {
        const allTrips = [];
        const limit = 50; // å‡è®¾æ¯æ¬¡è¯·æ±‚è¿”å› 50 æ¡æ•°æ®
        const maxSkip = 1500;
        const delay = ms => new Promise(resolve => setTimeout(resolve, ms));

        for (let skip = 0; skip <= maxSkip; skip += limit) {
            try {
                console.log(`è·å– skip=${skip} çš„æ•°æ®...`);
                const trips = await fetchTrips(skip);
                if (Array.isArray(trips)) {
                    allTrips.push(...trips);
                    cachedTrips = trips; // æ›´æ–°ç¼“å­˜
                } else {
                    console.warn(`Skip=${skip} è¿”å›éæ•°ç»„æ•°æ®:`, trips);
                }
                // æ·»åŠ  200 æ¯«ç§’å»¶è¿Ÿï¼Œé¿å…è¯·æ±‚è¿‡å¿«
                //await delay(200);
            } catch (error) {
                console.error(`è·å– skip=${skip} å¤±è´¥:`, error);
                alert(`è·å– skip=${skip} å¤±è´¥: ${error.message}`);
            }
        }

        // ç­›é€‰ serviceArea = "681d306b41bcbf28cb2c50f3" çš„è¡Œç¨‹
        const filteredTrips = allTrips.filter(trip => trip.serviceArea === '681d306b41bcbf28cb2c50f3');
        console.log(`ç­›é€‰å‡º ${filteredTrips.length} æ¡ serviceArea=681d306b41bcbf28cb2c50f3 çš„è¡Œç¨‹`);
        return filteredTrips;
    };

    // åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºè¡Œç¨‹æ•°æ®
    async function displayTrips(trips){
        //å¦‚æœä¸åœ¨è§„å®šæ—¶é—´(7:00-18:00),åœæ­¢è‡ªåŠ¨æ›´æ–°trip,ç›´æ¥return false

        let thisHour=new Date().getHours()
        if(thisHour<7 || thisHour>18) return false;

        let drivers=JSON.parse(JSON.stringify(driversTrip));
/*
        const container = document.createElement('div');
        container.style.cssText = 'position: fixed; top: 50px; right: 900px; background: white; padding: 15px; border: 1px solid #ccc; max-height: 80vh; overflow-y: auto; z-index: 1000; box-shadow: 0 0 10px rgba(0,0,0,0.2);';
        container.innerHTML = '<h3 id="hide_list" style="margin-top: 0;">è¡Œç¨‹åˆ—è¡¨ï¼ˆIOA - Paceï¼‰</h3>';

        if (!Array.isArray(trips) || trips.length === 0) {
            container.innerHTML += '<p>æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è¡Œç¨‹ã€‚</p>';
            document.body.appendChild(container);
            return;
        }
*/
        trips.forEach(trip => {
            const driverObj=trip.driver ? trip.driver : {displayName:"unschedule"}


            const driver=driverObj.displayName
            const prt=trip.priorityClient.displayName
            const pickup=toHHmm(trip.scheduleTime)
            const dropoff=toHHmm(trip.appointmentTime)
            const status=trip.jobStatus

            const puaddress=trip.jobOriginAddress
            const doaddress=trip.jobDestinationAddress
            const note=trip.companyNote

            let temp={id:prt,pickup,dropoff,status,puaddress,doaddress,note}
            if(driver=="Han Yang Zhou"){
                drivers[0].passengers.push(temp)
            }else if(driver=="Rong Tang"){
                drivers[1].passengers.push(temp)
            }else if(driver=="Mauricio Reina"){
                drivers[2].passengers.push(temp)
            }else if(driver=="Jerry Higgins"){
                drivers[3].passengers.push(temp)
            }else if(driver=="Mingzhan Li"){
                drivers[4].passengers.push(temp)
            }else if(driver=="Jerald Alejandro"){
                drivers[5].passengers.push(temp)
                /*}else if(driver=="Fook Fung"){
                    drivers[5].passengers.push(temp)*/
            }else if(driver=="Walter Mejia"){
                drivers[6].passengers.push(temp)
            }else if(driver=="Zhao Zhong Zheng"){
                drivers[7].passengers.push(temp)
            }else if(driver=="Jabari Tyler"){
                drivers[8].passengers.push(temp)
            }else if(driver=="Yingyang Chen"){
                drivers[9].passengers.push(temp)
            }else if(driver=="Bert Reid"){
                drivers[10].passengers.push(temp)
            }else if(driver=="Jie Qian"){
                drivers[11].passengers.push(temp)
            }else if(driver=="Wilson Ochoa"){
                drivers[13].passengers.push(temp)
            }else{
                drivers[14].passengers.push(temp)
            }


/*
            const tripDiv = document.createElement('div');
            tripDiv.style.cssText = 'margin-bottom: 10px;';
            tripDiv.innerHTML = `
                <strong>å¸æœº:</strong> ${driverObj.displayName ? driverObj.displayName : 'æ— '}<br>
                <strong>å®¢æˆ·:</strong> ${trip.priorityClient ? trip.priorityClient.displayName : 'æ— '}<br>
                <strong>èµ·ç‚¹:</strong> ${trip.jobOriginAddress || 'æ— '}<br>
                <strong>ç»ˆç‚¹:</strong> ${trip.jobDestinationAddress || 'æ— '}<br>
                <strong>Pickup æ—¶é—´:</strong> ${trip.scheduleTime ? new Date(trip.scheduleTime).toLocaleString('zh-CN') : 'æ— '}<br>
                <strong>Dropoff æ—¶é—´:</strong> ${trip.appointmentTime ? new Date(trip.appointmentTime).toLocaleString('zh-CN') : 'æ— '}<br>
                <strong >çŠ¶æ€:</strong> ${trip.jobStatus.includes("cancel")?`<font style='color:red'>`+trip.jobStatus+`</font>`:trip.jobStatus || 'æ— '}<br>
                <strong>é‡Œç¨‹:</strong> ${trip.milage || 'æ— '} è‹±é‡Œ<br>
                <strong>è¡Œç¨‹å¤‡æ³¨:</strong> ${trip.companyNote || 'æ— '}<br>
                <hr>
            `;
            container.appendChild(tripDiv);
*/
        });

         try {
                //console.log(111)
                await fetchLunchTimes(drivers);
            } catch (err) {
                console.error('å¤±è´¥:', err);
            }


        return JSON.stringify(drivers)



        // ç§»é™¤æ—§çš„å®¹å™¨
        //const oldContainer = document.querySelector('div[style*="position: fixed; top: 10px; right: 300px"]');
        //if (oldContainer) oldContainer.remove();
//        document.body.appendChild(container);
    };

    // åˆ›å»ºåˆ·æ–°æŒ‰é’®
    const createRefreshButton = () => {
        const button = document.createElement('button');
        button.textContent = 'åˆ·æ–°è¡Œç¨‹';
        button.style.cssText = 'position: fixed; top: 10px; left: 350px; z-index: 1000; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;';
        button.onclick = async () => {
            button.disabled = true; // ç¦ç”¨æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
            try {
                const trips = await fetchAllTrips();
                displayTrips(trips);
                console.log('è¡Œç¨‹å·²åˆ·æ–°:', trips);
            } catch (error) {
                console.error('åˆ·æ–°è¡Œç¨‹å¤±è´¥:', error);
                //alert('åˆ·æ–°è¡Œç¨‹å¤±è´¥: ' + error.message);
            } finally {
                button.disabled = false; // æ¢å¤æŒ‰é’®
            }
        };
        document.body.appendChild(button);
    };

    // åˆå§‹åŒ–
    createRefreshButton();

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–æ•°æ®
/*
    (async () => {
        try {
            const trips = await fetchAllTrips();
            displayTrips(trips);
            console.log('åˆå§‹è¡Œç¨‹å·²åŠ è½½:', trips);
        } catch (error) {
            console.error('åˆå§‹åŠ è½½å¤±è´¥:', error);
            alert('åˆå§‹åŠ è½½å¤±è´¥: ' + error.message);
        }
    })();
*/

    function toHHmm(isoString) {
        const date = new Date(isoString);
        const hours = String(date.getUTCHours()).padStart(2, '0');
        const minutes = String(date.getUTCMinutes()).padStart(2, '0');
        return `${hours}:${minutes}`;
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    // ç¤ºä¾‹ï¼šè·å–å­—ç¬¦ä¸²
    async function getTrips() {
        //å¦‚æœä¸åœ¨è§„å®šæ—¶é—´(7:00-18:00),åœæ­¢è‡ªåŠ¨æ›´æ–°trip,ç›´æ¥return false
        let thisHour=new Date().getHours()
        if(thisHour<7 || thisHour>18) return false;

        let tripStr=""
        let drivers=JSON.parse(JSON.stringify(driversTrip));
        if($("tbody tr").length>0){


            $("table tbody tr").each(function(){
                let driver= $(this).find("td").eq(3).text().replace("Reassign","").trim()
                let prt= $(this).find("td").eq(11).text().trim()
                let pickup=$(this).find("td").eq(13).text().trim().slice(-4)
                let dropoff=$(this).find("td").eq(14).text().trim().slice(-4)
                let status=$(this).find("td").eq(2).text().trim()

                let puaddress=$(this).find("td").eq(13).text().split("San Francisco")[0].trim()
                let doaddress=$(this).find("td").eq(14).text().split("San Francisco")[0].trim()

                prt=(status.includes("VIP")?"ğŸ”¥":"")+prt

                status=status.includes("Cancelled")?3:
                status.includes("Finished")?2:
                status.includes("Onboard")?1:0
                let temp={id:prt,pickup,dropoff,status,puaddress,doaddress}
                //console.log(JSON.stringify(temp))
                if(driver=="Han Yang Zhou"){
                    drivers[0].passengers.push(temp)
                }else if(driver=="Rong Tang"){
                    drivers[1].passengers.push(temp)
                }else if(driver=="Mauricio Reina"){
                    drivers[2].passengers.push(temp)
                }else if(driver=="Jerry Higgins"){
                    drivers[3].passengers.push(temp)
                }else if(driver=="Mingzhan Li"){
                    drivers[4].passengers.push(temp)
                }else if(driver=="Jerald Alejandro"){
                    drivers[5].passengers.push(temp)
                /*}else if(driver=="Fook Fung"){
                    drivers[5].passengers.push(temp)*/
                }else if(driver=="Walter Mejia"){
                    drivers[6].passengers.push(temp)
                }else if(driver=="Zhao Zhong Zheng"){
                    drivers[7].passengers.push(temp)
                }else if(driver=="Jabari Tyler"){
                    drivers[8].passengers.push(temp)
                }else if(driver=="Yingyang Chen"){
                    drivers[9].passengers.push(temp)
                }else if(driver=="Bert Reid"){
                    drivers[10].passengers.push(temp)
                }else if(driver=="Jie Qian"){
                    drivers[11].passengers.push(temp)
                }else if(driver=="Wilson Ochoa"){
                    drivers[13].passengers.push(temp)
                }else{
                    drivers[14].passengers.push(temp)
                }
            })

            try {
                //console.log(111)
                await fetchLunchTimes(drivers);
            } catch (err) {
                console.error('å¤±è´¥:', err);
            }

            tripStr=JSON.stringify(drivers)

            return tripStr

        }else{
            return false
        }

        //return document.querySelector('#some-element').innerText; // æ›¿æ¢ä¸ºä½ çš„é€‰æ‹©å™¨
    }

    // ä¸»é€»è¾‘ï¼šæ¯åˆ†é’Ÿè¿è¡Œ
    async function run() {
/*

        if($("#updateTripSheet").length==0){
            $(".flex.gap-2").eq(1).append(`<button id="updateTripSheet" class="btn btn-primary">update Trip Sheet</button>`)
            $("#updateTripSheet").click(async function(){
                $(this).removeClass("btn-primary","fast").addClass("btn-danger","fast")
                $(this).text("updating...")
                await run();

                $(this).removeClass("btn-danger","fast").addClass("btn-primary","fast")
                $(this).text("update Trip Sheet")

            })
        }
*/
        //const content = await getTrips();
        const content =await displayTrips()
        /*
        try{
            // æŸ¥æ‰¾ç›®æ ‡ ä¿®æ”¹ æ—¥æœŸ
            const targetInput = document.querySelector('input.form-control.w-52[placeholder="Select Date"]');

            if (targetInput) {
                //console.log('Found target input:', targetInput);

                // è·å–ä»Šå¤©çš„æ—¥æœŸå¹¶æ ¼å¼åŒ–ä¸º M/D/YYYY
                const today = new Date();
                const month = today.getMonth() + 1; // æœˆä»½ä» 0 å¼€å§‹ï¼Œéœ€åŠ  1
                const day = today.getDate();
                const year = today.getFullYear();
                const formattedDate = `${month}/${day}/${year}`;
                const newValue = `${formattedDate} ~ ${formattedDate}`; // ä¾‹å¦‚ "6/7/2025 ~ 6/7/2025"

                if(newValue!==targetInput.value){

                    // ä¸´æ—¶ç§»é™¤ readonly å±æ€§ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                    if (targetInput.hasAttribute('readonly')) {
                        targetInput.removeAttribute('readonly');
                    }

                    // è®¾ç½®æ–°å€¼
                    targetInput.value = newValue;

                    // è§¦å‘ input äº‹ä»¶ï¼Œé€šçŸ¥ Angular æ›´æ–°æ¨¡å‹
                    const inputEvent = new Event('input', {
                        bubbles: true,
                        cancelable: true
                    });
                    targetInput.dispatchEvent(inputEvent);

                    // è§¦å‘ change äº‹ä»¶ï¼ˆæŸäº›æƒ…å†µä¸‹éœ€è¦ï¼‰
                    const changeEvent = new Event('change', {
                        bubbles: true,
                        cancelable: true
                    });
                    targetInput.dispatchEvent(changeEvent);

                    // æ¢å¤ readonly å±æ€§
                    targetInput.setAttribute('readonly', '');
                }
            } else {
                console.log('Target input not found');
            }


            $("button:contains('Reset')").click()
        }catch(e){
        }
        */
        //console.log(content)

        if (content) {
            saveToKV(content);
        } else {
            console.error('æœªæ‰¾åˆ°å†…å®¹');
        }

    }

//    await run(); // ç«‹å³è¿è¡Œ
    setInterval(run, 60000); // æ¯åˆ†é’Ÿ


    //ç”¨å¼‚æ­¥åŒ…è£…è·å–å¸æœºåƒé¥­æ—¶é—´-----------------------å¼€å§‹
    const apiUrl = 'https://script.google.com/macros/s/AKfycbzBdbSd3xujI7CAwxPfD5b8KOktG6Z4VjqE_8q512q5Bc3MJjFRurs-aODOI-sIFzJR/exec';
    // åŒ…è£… GM_xmlhttpRequest ä¸º Promise
    function gmFetch(options) {
        return new Promise((resolve, reject) => {
            GM_xmlhttpRequest({
                ...options,
                onload: (response) => {
                    resolve(response);
                },
                onerror: (err) => {
                    reject(err);
                }
            });
        });
    }
    // å¼‚æ­¥è·å–æ•°æ®
    async function fetchLunchTimes(drivers) {
        try {
            const response = await gmFetch({
                method: 'GET',
                url: apiUrl,
            });
            console.log('è¯·æ±‚å®Œæˆï¼ŒçŠ¶æ€ç :', response.status);
            if (response.status === 200) {
                try {
                    const data = JSON.parse(response.responseText);
                    console.log('æ•°æ®è·å–æˆåŠŸ:', data);
                    for(let i=1;i<data.length;i++){
                        let temp={"id":"Lunch","pickup":data[i][1]+"","dropoff":data[i][2]+""}
                        let driver=data[i][0]
                        if(driver=="Han Yang Zhou"){
                            drivers[0].passengers.push(temp)
                        }else if(driver=="Rong Tang"){
                            drivers[1].passengers.push(temp)
                        }else if(driver=="Mauricio Reina"){
                            drivers[2].passengers.push(temp)
                        }else if(driver=="Jerry Higgins"){
                            drivers[3].passengers.push(temp)
                        }else if(driver=="Mingzhan Li"){
                            drivers[4].passengers.push(temp)
                        }else if(driver=="Fook Fung"){
                            drivers[5].passengers.push(temp)
                        }else if(driver=="Walter Mejia"){
                            drivers[6].passengers.push(temp)
                        }else if(driver=="Zhao Zhong Zheng"){
                            drivers[7].passengers.push(temp)
                        }else if(driver=="Jabari Tyler"){
                            drivers[8].passengers.push(temp)
                        }else if(driver=="Yingyang Chen"){
                            drivers[9].passengers.push(temp)
                        }else if(driver=="Bert Reid"){
                            drivers[10].passengers.push(temp)
                        }else if(driver=="Jie Qian"){
                            drivers[11].passengers.push(temp)
                        }else if(driver=="Jerald Alejandro"){
                            drivers[12].passengers.push(temp)
                        }else if(driver=="Wilson Ochoa"){
                            drivers[13].passengers.push(temp)
                        }else{
                            drivers[14].passengers.push(temp)
                        }
                    }
                    //return data;
                } catch (e) {
                    console.error('è§£æ JSON å¤±è´¥:', e, response.responseText);
                    throw new Error(`JSON è§£æå¤±è´¥: ${e.message}`);
                }
            } else {
                console.error('è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç :', response.status, 'å“åº”:', response.responseText);
                throw new Error(`è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : ${response.status}`);
            }
        } catch (err) {
            console.error('è¯·æ±‚é”™è¯¯:', err);
            throw err;
        }
    }
    //ç”¨å¼‚æ­¥åŒ…è£…è·å–å¸æœºåƒé¥­æ—¶é—´--------------------------ç»“æŸ
    // Your code here...
})();
